<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ä¸–ç•Œå—ç§‘æˆé•·è¨ˆåŠƒ</title>
    
    <!-- PWA Settings -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä¸–ç•Œå—ç§‘æˆé•·ä¸­">
    <meta name="theme-color" content="#0f172a">
    <link rel="apple-touch-icon" href="icon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide React Icons (Using version 0.263.1 for best UMD compatibility) -->
    <script src="https://unpkg.com/lucide-react@0.263.1/dist/umd/lucide-react.min.js"></script>

    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f8fafc;
        }
        /* Hide scrollbar */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #f8fafc; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        
        /* Animation */
        @keyframes fade-in-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in-up {
            animation: fade-in-up 0.5s ease-out forwards;
        }
        
        @keyframes slide-up {
            from { transform: translate(-50%, 100%); opacity: 0; }
            to { transform: translate(-50%, 0); opacity: 1; }
        }
        .toast-enter {
            animation: slide-up 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body class="text-slate-600 pb-24">
    <div id="root"></div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        window.firebaseModules = { initializeApp, getAuth, signInAnonymously, getFirestore, doc, setDoc, onSnapshot };
    </script>

    <script type="text/babel">
        const { useState, useMemo, useEffect, useRef } = React;
        
        const LucideIcons = window.lucideReact || {};
        const { 
            CheckCircle2, Circle, TrendingUp, PiggyBank, Calendar, AlertCircle, Wallet, 
            Clock, Edit2, Save, X, History, ArrowRight, DollarSign, Calculator, Check, 
            Home, Building2, PieChart, Cloud, WifiOff, AlertTriangle, Heart, Lock, KeyRound
        } = LucideIcons;

        // **********************************************************
        // â˜…â˜…â˜… è¨­å®šå€ â˜…â˜…â˜…
        // **********************************************************
        
        // è¨­å®šæ‚¨çš„å…±ç”¨å¯†ç¢¼ (å¯ä»¥è‡ªè¡Œä¿®æ”¹é€™è£¡)
        const APP_PASSWORD = "2028"; 
        
        const MILESTONE_COSTS = {
            '2023-10-01': { name: 'è¨‚é‡‘+ç°½ç´„é‡‘', cost: 580000, payer: 'shuan' },
            '2024-01-01': { name: '1æ¨“åº•æ¿å·¥ç¨‹', cost: 480000, payer: 'shuan' },
            '2025-07-01': { name: '13æ¨“åº•æ¿+RC', cost: 220000 },
            '2026-04-01': { name: 'çµæ§‹é«”ä¸Šæ¨‘', cost: 950000 },
            '2027-04-01': { name: '2027å¹´åº¦å·¥ç¨‹æ¬¾', cost: 950000 },
            '2028-04-01': { name: 'äº¤å±‹æ¬¾', cost: 800000 },
            '2028-06-01': { name: 'æš«æ”¶æ¬¾', cost: 250000 }
        };

        const generateData = () => {
            const data = [];
            let startDate = new Date(2023, 9, 1);
            let endDate = new Date(2028, 12, 1);
            let currentDate = new Date(startDate);
            let idCounter = 1;

            // 0. åˆæœŸè³‡é‡‘
            data.push({
                id: idCounter++,
                type: 'income',
                subType: 'adjustment',
                label: 'åˆæœŸè³‡é‡‘/å¸³æˆ¶æ ¡æ­£',
                date: '2023-09-30',
                yaoAmount: 310000,
                shuanAmount: 125000,
                yaoPaidDate: null, 
                shuanPaidDate: null,
            });

            while (currentDate <= endDate) {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth() + 1;
                const dateStr = `${year}-${month.toString().padStart(2, '0')}-01`;
                
                // 1. æœˆå­˜
                data.push({
                    id: idCounter++,
                    type: 'income',
                    subType: 'monthly',
                    label: `${year}å¹´ ${month}æœˆå­˜æ¬¾`,
                    date: dateStr,
                    yaoAmount: 20000,
                    shuanAmount: 10000,
                    yaoPaidDate: null,
                    shuanPaidDate: null,
                });

                // 2. å­£åº¦åˆ†ç´…
                if (month === 2 || month === 5 || month === 8 || month === 11) {
                    data.push({
                        id: idCounter++,
                        type: 'income',
                        subType: 'bonus',
                        label: `${year}å¹´ ${month}æœˆåˆ†ç´…`,
                        date: dateStr,
                        yaoAmount: 50000,
                        shuanAmount: 30000,
                        yaoPaidDate: null,
                        shuanPaidDate: null,
                    });
                }

                // 3. å¹´çµ‚
                if (month === 12) {
                    data.push({
                        id: idCounter++,
                        type: 'income',
                        subType: 'year-end',
                        label: `${year}å¹´ å¹´çµ‚çé‡‘`,
                        date: dateStr,
                        yaoAmount: 90000,
                        shuanAmount: 60000,
                        yaoPaidDate: null,
                        shuanPaidDate: null,
                    });
                }

                // 4. å·¥ç¨‹æ¬¾
                const milestone = MILESTONE_COSTS[dateStr];
                if (milestone) {
                    let paidDate = null;
                    let paidDetails = { yao: 0, shuan: 0 };
                    
                    if (milestone.payer === 'shuan') {
                        paidDate = dateStr;
                        paidDetails.shuan = milestone.cost;
                    }

                    data.push({
                        id: idCounter++,
                        type: 'expense',
                        label: milestone.name,
                        cost: milestone.cost,
                        date: dateStr,
                        paidDate: paidDate,
                        paidDetails: paidDetails, 
                    });
                }

                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            return data.sort((a, b) => {
                const dateDiff = new Date(a.date) - new Date(b.date);
                if (dateDiff !== 0) return dateDiff;
                if (a.type !== b.type) return a.type === 'expense' ? -1 : 1;
                return 0;
            });
        };

        // --- Login Screen Component ---
        const LoginScreen = ({ onLogin }) => {
            const [input, setInput] = useState("");
            const [error, setError] = useState(false);

            useEffect(() => {
                // Check if previously logged in
                const savedAuth = localStorage.getItem('nanke_auth_token');
                if (savedAuth === APP_PASSWORD) {
                    onLogin();
                }
            }, []);

            const handleLogin = (e) => {
                e.preventDefault();
                if (input === APP_PASSWORD) {
                    localStorage.setItem('nanke_auth_token', input); // Remember login
                    onLogin();
                } else {
                    setError(true);
                    setTimeout(() => setError(false), 2000);
                }
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-slate-50">
                    <div className="bg-white p-8 rounded-3xl shadow-xl w-full max-w-sm border border-slate-100 animate-fade-in-up">
                        <div className="flex justify-center mb-6">
                            <div className="p-4 bg-teal-50 rounded-full text-teal-600">
                                {Lock && <Lock size={48} />}
                            </div>
                        </div>
                        <h2 className="text-2xl font-bold text-center text-slate-800 mb-2">æ­¡è¿å›ä¾†</h2>
                        <p className="text-slate-400 text-center mb-6 text-sm">è«‹è¼¸å…¥å®¶åº­å¯†ç¢¼ä»¥ç¹¼çºŒ</p>
                        
                        <form onSubmit={handleLogin} className="space-y-4">
                            <div className="relative">
                                <div className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                    {KeyRound && <KeyRound size={20} />}
                                </div>
                                <input 
                                    type="password" 
                                    value={input}
                                    onChange={(e) => setInput(e.target.value)}
                                    placeholder="è¼¸å…¥å¯†ç¢¼ (é è¨­: 2028)"
                                    className={`w-full pl-10 pr-4 py-3 rounded-xl border outline-none transition-all ${error ? 'border-red-400 bg-red-50 text-red-600' : 'border-slate-200 focus:border-teal-500 focus:ring-2 focus:ring-teal-100'}`}
                                    autoFocus
                                />
                            </div>
                            <button 
                                type="submit"
                                className="w-full bg-teal-600 text-white py-3 rounded-xl font-bold hover:bg-teal-700 active:scale-95 transition-all shadow-md shadow-teal-200"
                            >
                                è§£é–é€²å…¥
                            </button>
                        </form>
                        {error && <p className="text-red-500 text-xs text-center mt-3 font-bold animate-pulse">å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹å†è©¦ä¸€æ¬¡</p>}
                    </div>
                    <div className="mt-8 text-slate-400 text-xs flex items-center gap-1">
                        {Heart && <Heart size={12} className="fill-rose-300 text-rose-300" />} ä¸–ç•Œå—ç§‘æˆé•·è¨ˆåŠƒ
                    </div>
                </div>
            );
        };

        const MainApp = () => {
            const [handoverDate, setHandoverDate] = useState('2028-04-30');
            const [totalHousePrice, setTotalHousePrice] = useState(15910000); 
            const [transactions, setTransactions] = useState([]);
            const [isLoaded, setIsLoaded] = useState(false);
            const [isOnline, setIsOnline] = useState(false); 
            const [lastSyncTime, setLastSyncTime] = useState('');
            const [toast, setToast] = useState(null); 

            useEffect(() => {
                const initFirebase = async () => {
                    let attempts = 0;
                    while (!window.firebaseModules && attempts < 10) {
                        await new Promise(r => setTimeout(r, 200));
                        attempts++;
                    }

                    if (!window.firebaseModules) {
                        console.error("Firebase failed to load");
                        loadLocalData();
                        return;
                    }

                    const { initializeApp, getAuth, signInAnonymously, getFirestore, doc, setDoc, onSnapshot } = window.firebaseModules;

                    let firebaseConfig = {
                        apiKey: "AIzaSyD2Fe27bWR2_FT0xHv2hDmtOFA9Swfj3GA",
                        authDomain: "our-dream-nest.firebaseapp.com",
                        projectId: "our-dream-nest",
                        storageBucket: "our-dream-nest.firebasestorage.app",
                        messagingSenderId: "284184533162",
                        appId: "1:284184533162:web:07295a684260ae7cf618d3"
                    };

                    try {
                        const app = initializeApp(firebaseConfig);
                        const auth = getAuth(app);
                        const db = getFirestore(app);
                        const appId = 'nanke-sweet-home'; 

                        await signInAnonymously(auth);
                        setIsOnline(true);

                        const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'savings_v2', 'shared_tracker');

                        onSnapshot(docRef, (snapshot) => {
                            if (snapshot.exists()) {
                                const data = snapshot.data();
                                const baseData = generateData();
                                
                                setHandoverDate(data.handoverDate || '2028-04-30');
                                setTotalHousePrice(data.totalHousePrice || 15910000);
                                
                                const merged = baseData.map(item => {
                                    const saved = data.overrides && data.overrides[item.id];
                                    if (saved) return { ...item, ...saved };
                                    
                                    const itemDate = new Date(item.date);
                                    const cutoffDate = new Date();
                                    if (itemDate <= cutoffDate && item.type === 'income') {
                                        return { ...item, yaoPaidDate: item.date, shuanPaidDate: item.date };
                                    }
                                    return item;
                                });
                                setTransactions(merged);
                                setIsLoaded(true);
                                const now = new Date();
                                setLastSyncTime(now.toLocaleTimeString('zh-TW', { hour: '2-digit', minute: '2-digit', second: '2-digit' }));
                            } else {
                                saveDataToCloud(db, appId, {
                                    handoverDate: '2028-04-30',
                                    totalHousePrice: 15910000,
                                    overrides: {}
                                });
                                loadLocalData(); 
                            }
                        }, (error) => {
                            console.error("Sync error:", error);
                            setIsOnline(false);
                            loadLocalData();
                        });

                        window.saveToCloud = (data) => saveDataToCloud(db, appId, data);

                    } catch (err) {
                        console.error("Firebase init failed:", err);
                        setIsOnline(false);
                        loadLocalData();
                    }
                };

                initFirebase();
            }, []);

            const loadLocalData = () => {
                const baseData = generateData();
                const cutoffDate = new Date();
                setTransactions(baseData.map(item => {
                    const itemDate = new Date(item.date);
                    if (itemDate <= cutoffDate && item.type === 'income') {
                        return { ...item, yaoPaidDate: item.date, shuanPaidDate: item.date };
                    }
                    return item;
                }));
                setIsLoaded(true);
            };

            const saveDataToCloud = async (db, appId, data) => {
                const { doc, setDoc } = window.firebaseModules;
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'savings_v2', 'shared_tracker');
                await setDoc(docRef, data, { merge: true });
            };

            const handleSave = () => {
                if (!window.saveToCloud) return; 

                const overrides = {};
                transactions.forEach(t => {
                    overrides[t.id] = {
                        yaoAmount: t.yaoAmount,
                        shuanAmount: t.shuanAmount,
                        yaoPaidDate: t.yaoPaidDate,
                        shuanPaidDate: t.shuanPaidDate,
                        paidDate: t.paidDate,
                        paidDetails: t.paidDetails
                    };
                });

                window.saveToCloud({
                    handoverDate,
                    totalHousePrice,
                    overrides
                });
            };

            // Removed auto-save useEffect to prevent loop. Save is now triggered by user actions.

            const [isEditingHandover, setIsEditingHandover] = useState(false);
            const [tempHandoverDate, setTempHandoverDate] = useState('2028-04-30');
            const [isEditingPrice, setIsEditingPrice] = useState(false);
            const [tempPrice, setTempPrice] = useState(15910000);
            const [isEditingLoan, setIsEditingLoan] = useState(false);
            const [tempLoan, setTempLoan] = useState(0);
            const [editingTransaction, setEditingTransaction] = useState(null);
            const [editValue, setEditValue] = useState('');
            const [expenseInput, setExpenseInput] = useState({ yao: '', shuan: '' });

            useEffect(() => {
                const manifest = {
                    name: "ä¸–ç•Œå—ç§‘æˆé•·è¨ˆåŠƒ",
                    short_name: "ä¸–ç•Œå—ç§‘æˆé•·ä¸­",
                    start_url: ".",
                    display: "standalone",
                    background_color: "#f8fafc",
                    theme_color: "#0f172a",
                    icons: [
                        { src: "icon.png", sizes: "192x192", type: "image/png", purpose: "any maskable" },
                        { src: "icon.png", sizes: "512x512", type: "image/png", purpose: "any maskable" }
                    ]
                };
                const stringManifest = JSON.stringify(manifest);
                const blob = new Blob([stringManifest], {type: 'application/json'});
                const manifestURL = URL.createObjectURL(blob);
                
                let linkManifest = document.querySelector('link[rel="manifest"]');
                if (!linkManifest) {
                    linkManifest = document.createElement('link');
                    linkManifest.rel = 'manifest';
                    document.head.appendChild(linkManifest);
                }
                linkManifest.href = manifestURL;
            }, []);

            const formatMoney = (amount) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', minimumFractionDigits: 0 }).format(amount);
            const getTodayString = () => new Date().toISOString().split('T')[0];

            const showToast = (msg) => {
                setToast(msg);
                setTimeout(() => setToast(null), 3000);
            };

            // Stats
            const stats = useMemo(() => {
                let yaoSaved = 0;   
                let shuanSaved = 0; 
                let yaoPaidDirectly = 0;   
                let shuanPaidDirectly = 0; 
                let totalExpensePaid = 0;
                let totalPlannedCost = 0; 

                transactions.forEach(t => {
                    if (t.type === 'income') {
                        if (t.yaoPaidDate) yaoSaved += t.yaoAmount;
                        if (t.shuanPaidDate) shuanSaved += t.shuanAmount;
                    } else if (t.type === 'expense') {
                        totalPlannedCost += t.cost;
                        if (t.paidDate) {
                            totalExpensePaid += t.cost;
                            if (t.paidDetails) {
                                yaoPaidDirectly += (t.paidDetails.yao || 0);
                                shuanPaidDirectly += (t.paidDetails.shuan || 0);
                            }
                        }
                    }
                });

                const expensesPaidFromPool = totalExpensePaid - (yaoPaidDirectly + shuanPaidDirectly);
                const currentPool = (yaoSaved + shuanSaved) - expensesPaidFromPool;

                return {
                    yaoSaved, shuanSaved, yaoPaidDirectly, shuanPaidDirectly,
                    currentPool, totalExpensePaid, totalPlannedCost,
                    loanAmount: totalHousePrice - totalPlannedCost
                };
            }, [transactions, totalHousePrice]);

            const breakdown = useMemo(() => {
                const result = {
                    yao: { adjustment: 0, monthly: 0, bonus: 0, yearEnd: 0, total: 0 },
                    shuan: { adjustment: 0, monthly: 0, bonus: 0, yearEnd: 0, total: 0 }
                };
                transactions.forEach(t => {
                    if (t.type === 'income') {
                        if (t.yaoPaidDate) {
                            if (t.subType === 'adjustment') result.yao.adjustment += t.yaoAmount;
                            else if (t.subType === 'monthly') result.yao.monthly += t.yaoAmount;
                            else if (t.subType === 'bonus') result.yao.bonus += t.yaoAmount;
                            else if (t.subType === 'year-end') result.yao.yearEnd += t.yaoAmount;
                        }
                        if (t.shuanPaidDate) {
                            if (t.subType === 'adjustment') result.shuan.adjustment += t.shuanAmount;
                            else if (t.subType === 'monthly') result.shuan.monthly += t.shuanAmount;
                            else if (t.subType === 'bonus') result.shuan.bonus += t.shuanAmount;
                            else if (t.subType === 'year-end') result.shuan.yearEnd += t.shuanAmount;
                        }
                    }
                });
                result.yao.total = result.yao.adjustment + result.yao.monthly + result.yao.bonus + result.yao.yearEnd;
                result.shuan.total = result.shuan.adjustment + result.shuan.monthly + result.shuan.bonus + result.shuan.yearEnd;
                return result;
            }, [transactions]);

            const nextExpense = useMemo(() => transactions.find(t => t.type === 'expense' && !t.paidDate), [transactions]);

            const balanceStatus = useMemo(() => {
                if (!nextExpense) return { status: 'all_clear', diff: 0 };
                const currentInputTotal = (parseInt(expenseInput.yao || 0) + parseInt(expenseInput.shuan || 0));
                const remainingCostFromPool = Math.max(0, nextExpense.cost - currentInputTotal);
                const diff = stats.currentPool - remainingCostFromPool;
                return { status: diff >= 0 ? 'sufficient' : 'insufficient', diff: diff };
            }, [stats.currentPool, nextExpense, expenseInput]);

            const countdown = useMemo(() => {
                if (!handoverDate) return 0;
                const [y, m, d] = handoverDate.split('-').map(Number);
                const target = new Date(y, m - 1, d); 
                const today = new Date();
                today.setHours(0, 0, 0, 0); 
                const diff = Math.ceil((target - today) / (1000 * 60 * 60 * 24));
                return diff > 0 ? diff : 0;
            }, [handoverDate]);

            // UI Actions
            const saveHandoverDateUI = () => { 
                const newDate = tempHandoverDate;
                setHandoverDate(newDate); 
                setIsEditingHandover(false);
                saveAllToCloud(transactions, newDate, totalHousePrice);
            };
            const savePriceUI = () => { 
                const newPrice = tempPrice;
                setTotalHousePrice(newPrice); 
                setIsEditingPrice(false);
                saveAllToCloud(transactions, handoverDate, newPrice);
            };
            const saveLoanUI = () => { 
                const newPrice = tempLoan + stats.totalPlannedCost;
                setTotalHousePrice(newPrice); 
                setIsEditingLoan(false);
                saveAllToCloud(transactions, handoverDate, newPrice);
            };

            // Modified: Check date with confirmation
            const startEditing = (item, person) => {
                const itemDate = new Date(item.date);
                const today = new Date();
                
                if (itemDate > today) {
                    const isConfirmed = window.confirm("å°šæœªåˆ°é”è©²æœˆä»½ï¼Œç„¡æ³•é ç¹³æœªä¾†æ¬¾é … ğŸ™…â€â™‚ï¸ï¼Œå¦‚ç¢ºèªé ç¹³ï¼Œè«‹æŒ‰ç¢ºå®š");
                    if (!isConfirmed) return;
                }
                
                setEditingTransaction({ id: item.id, person });
                setEditValue(person === 'yao' ? item.yaoAmount : item.shuanAmount);
            };

            const confirmSaving = (id, person) => {
                const newAmount = parseInt(editValue, 10);
                if (isNaN(newAmount)) return;
                
                const newTransactions = transactions.map(item => {
                    if (item.id === id) {
                        const dateField = person === 'yao' ? 'yaoPaidDate' : 'shuanPaidDate';
                        const amountField = person === 'yao' ? 'yaoAmount' : 'shuanAmount';
                        return { ...item, [amountField]: newAmount, [dateField]: getTodayString() };
                    }
                    return item;
                });
                
                setTransactions(newTransactions);
                setEditingTransaction(null);
                saveAllToCloud(newTransactions, handoverDate, totalHousePrice);
            };

            const undoSaving = (id, person) => {
                const newTransactions = transactions.map(item => {
                    if (item.id === id) {
                        const field = person === 'yao' ? 'yaoPaidDate' : 'shuanPaidDate';
                        return { ...item, [field]: null };
                    }
                    return item;
                });
                setTransactions(newTransactions);
                saveAllToCloud(newTransactions, handoverDate, totalHousePrice);
            };

            const confirmExpenseAction = (id) => {
                const yaoPay = parseInt(expenseInput.yao || 0, 10);
                const shuanPay = parseInt(expenseInput.shuan || 0, 10);
                if (yaoPay + shuanPay <= 0 && !window.confirm("æœªè¼¸å…¥é‡‘é¡ï¼Œç¢ºå®šç›´æ¥å¾å…¬åŸºé‡‘æ‰£æ¬¾ï¼Ÿ")) return;
                
                const newTransactions = transactions.map(item => {
                    if (item.id === id) return { ...item, paidDate: getTodayString(), paidDetails: { yao: yaoPay, shuan: shuanPay } };
                    return item;
                });
                setTransactions(newTransactions);
                setExpenseInput({ yao: '', shuan: '' });
                saveAllToCloud(newTransactions, handoverDate, totalHousePrice);
            };

            if (!isLoaded) return <div className="min-h-screen flex items-center justify-center text-stone-400 bg-stone-50">è¼‰å…¥ä¸­...</div>;

            return (
                <div className="max-w-4xl mx-auto space-y-6 p-4 relative">
                    {/* Toast Notification */}
                    {toast && (
                        <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 bg-stone-800 text-orange-50 px-6 py-3 rounded-full shadow-lg z-50 flex items-center gap-3 toast-enter">
                            {AlertTriangle && <AlertTriangle size={20} className="text-orange-400" />}
                            <span className="text-sm font-bold">{toast}</span>
                        </div>
                    )}

                    {/* Header */}
                    <div className="bg-white rounded-2xl shadow-sm p-6 border-b-2 border-slate-100">
                        <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                            <div>
                                <div className="flex items-center gap-2" onClick={() => window.location.reload()}>
                                    <h1 className="text-2xl font-bold text-slate-800 flex items-center gap-2 tracking-tight">
                                        {Heart && <Heart className="text-teal-600 fill-teal-600" />} ä¸–ç•Œå—ç§‘æˆé•·è¨ˆåŠƒ
                                    </h1>
                                    {isOnline ? 
                                        <div className="flex flex-col items-start">
                                            <span className="bg-teal-50 text-teal-700 text-[10px] px-2 py-1 rounded-full flex items-center gap-1 font-bold">
                                                {Cloud && <Cloud size={12}/>} åŒæ­¥ä¸­
                                            </span>
                                            {lastSyncTime && <span className="text-[10px] text-slate-400 ml-1 mt-0.5">{lastSyncTime} æ›´æ–°</span>}
                                        </div>
                                         : 
                                        <span className="bg-slate-100 text-slate-500 text-[10px] px-2 py-1 rounded-full flex items-center gap-1 font-bold">{WifiOff && <WifiOff size={12}/>} é›¢ç·š</span>
                                    }
                                </div>
                                <div className="flex items-center gap-2 mt-2">
                                    {Building2 && <Building2 size={14} className="text-slate-400" />}
                                    <span className="text-sm text-slate-500">æˆ¿å±‹ç¸½åƒ¹: </span>
                                    {isEditingPrice ? (
                                        <div className="flex items-center gap-1">
                                            <input type="number" value={tempPrice} onChange={(e) => setTempPrice(Number(e.target.value))} className="w-32 text-sm p-1 border rounded-full bg-slate-50 text-slate-700 px-2"/>
                                            <button onClick={savePriceUI} className="text-teal-600 hover:bg-teal-50 rounded-full p-1">{Save && <Save size={14}/>}</button>
                                            <button onClick={() => setIsEditingPrice(false)} className="text-slate-400 hover:bg-slate-50 rounded-full p-1">{X && <X size={14}/>}</button>
                                        </div>
                                    ) : (
                                        <div className="flex items-center gap-1 group cursor-pointer" onClick={() => { setTempPrice(totalHousePrice); setIsEditingPrice(true); }}>
                                            <span className="text-sm font-bold text-slate-700 underline decoration-slate-200 decoration-dotted underline-offset-4">{formatMoney(totalHousePrice)}</span>
                                            {Edit2 && <Edit2 size={12} className="text-slate-300 group-hover:text-teal-500" />}
                                        </div>
                                    )}
                                </div>
                            </div>
                            <div className="bg-slate-50 px-4 py-3 rounded-xl flex items-center gap-4 w-full md:w-auto border border-slate-100">
                                <div className="text-teal-600">{Clock && <Clock size={24} />}</div>
                                <div className="flex-1">
                                    <div className="flex items-center gap-2 mb-1"><span className="text-xs font-bold text-slate-500 uppercase tracking-wide">äº¤å±‹å€’æ•¸</span></div>
                                    {isEditingHandover ? (
                                        <div className="flex items-center gap-2">
                                            <input type="date" value={tempHandoverDate} onChange={(e) => setTempHandoverDate(e.target.value)} className="text-sm p-1 border rounded-full bg-white px-2" />
                                            <button onClick={saveHandoverDateUI} className="text-teal-600">{Save && <Save size={16}/>}</button>
                                            <button onClick={() => setIsEditingHandover(false)} className="text-slate-400">{X && <X size={16}/>}</button>
                                        </div>
                                    ) : (
                                        <div className="flex flex-col group cursor-pointer" onClick={() => { setTempHandoverDate(handoverDate); setIsEditingHandover(true); }}>
                                            <div className="flex items-baseline gap-1"><span className="text-2xl font-bold text-slate-700">{countdown}</span><span className="text-sm text-slate-500">å¤©</span></div>
                                            <div className="flex items-center gap-1"><span className="text-xs text-slate-400 mt-1 decoration-dotted underline underline-offset-2">é è¨ˆ: {handoverDate}</span>{Edit2 && <div className="opacity-0 group-hover:opacity-100 transition-opacity"><Edit2 size={12} className="text-teal-500" /></div>}</div>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Financial Overview */}
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div className="bg-white text-slate-800 rounded-2xl p-6 shadow-sm border border-slate-100 md:col-span-2 flex flex-col md:flex-row justify-between items-center gap-4">
                            <div className="flex items-center gap-4">
                                <div className="bg-teal-50 p-3 rounded-full">{Home && <Home className="text-teal-600" size={24} />}</div>
                                <div><h3 className="text-xs font-bold text-slate-500 uppercase">å·²çŸ¥è‡ªå‚™æ¬¾/å·¥ç¨‹æ¬¾ç¸½é¡</h3><div className="text-2xl font-bold text-slate-800">{formatMoney(stats.totalPlannedCost)}</div></div>
                            </div>
                            <div className="hidden md:block w-px h-10 bg-slate-200"></div>
                            <div className="flex items-center gap-4">
                                <div>
                                    <h3 className="text-xs font-bold text-slate-500 uppercase text-right">é ä¼°è²¸æ¬¾é‡‘é¡</h3>
                                    {isEditingLoan ? (
                                        <div className="flex items-center justify-end gap-1">
                                            <input type="number" value={tempLoan} onChange={(e) => setTempLoan(Number(e.target.value))} className="w-32 text-lg p-1 border rounded bg-white text-slate-700 border-slate-200 text-right focus:outline-none focus:ring-1 focus:ring-teal-500" autoFocus />
                                            <button onClick={saveLoanUI} className="text-teal-600 hover:text-teal-700 p-1">{Save && <Save size={16}/>}</button>
                                            <button onClick={() => setIsEditingLoan(false)} className="text-slate-400 hover:text-slate-500 p-1">{X && <X size={16}/>}</button>
                                        </div>
                                    ) : (
                                        <div className="text-2xl font-bold text-slate-700 cursor-pointer hover:text-teal-600 transition-colors flex items-center justify-end gap-2 group" onClick={() => { setTempLoan(stats.loanAmount); setIsEditingLoan(true); }}>
                                            {formatMoney(stats.loanAmount)}
                                            {Edit2 && <Edit2 size={14} className="opacity-0 group-hover:opacity-100 transition-opacity text-slate-300" />}
                                        </div>
                                    )}
                                    <div className="text-[10px] text-slate-400 text-right">(ç¸½åƒ¹ - è‡ªå‚™æ¬¾)</div>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-2xl p-6 shadow-sm border border-slate-100 flex flex-col justify-center space-y-4 md:col-span-1">
                            <h2 className="text-xs font-bold text-slate-400 uppercase tracking-wider mb-1 flex items-center gap-1">å€‹äººç´¯ç©å­˜æ¬¾ <span className="text-[10px] text-slate-400 font-normal">(ä¸å«è‡ªä»˜å·¥ç¨‹æ¬¾)</span></h2>
                            <div className="flex justify-between items-center px-2">
                                <span className="text-lg font-bold text-slate-700">å ¯</span>
                                <div className="text-right"><span className="block text-sm font-bold text-sky-600 font-mono">{formatMoney(stats.yaoSaved)}</span>{stats.yaoPaidDirectly > 0 && <span className="block text-[10px] text-slate-400">å¦è‡ªä»˜: {formatMoney(stats.yaoPaidDirectly)}</span>}</div>
                            </div>
                            <div className="w-full h-px bg-slate-100"></div>
                            <div className="flex justify-between items-center px-2">
                                <span className="text-lg font-bold text-slate-700">ç’‡</span>
                                <div className="text-right"><span className="block text-sm font-bold text-rose-500 font-mono">{formatMoney(stats.shuanSaved)}</span>{stats.shuanPaidDirectly > 0 && <span className="block text-[10px] text-slate-400">å¦è‡ªä»˜: {formatMoney(stats.shuanPaidDirectly)}</span>}</div>
                            </div>
                        </div>

                        <div className="bg-slate-800 rounded-2xl p-6 text-white shadow-lg md:col-span-1 relative overflow-hidden">
                            <div className="absolute top-0 right-0 p-4 opacity-10">{Wallet && <Wallet size={120} />}</div>
                            <div className="relative z-10">
                                <h2 className="text-slate-300 text-sm font-medium mb-1 flex items-center gap-2">{Calculator && <Calculator size={16} />} ç›®å‰å…¬åŸºé‡‘é¤˜é¡ (ç¾é‡‘)</h2>
                                <p className="text-4xl font-bold mb-4 tracking-tight">{formatMoney(stats.currentPool)}</p>
                                <div className="flex flex-col sm:flex-row gap-4 text-xs text-slate-300 bg-white/10 backdrop-blur-sm p-3 rounded-xl w-fit border border-white/10">
                                    <div><span className="block opacity-70">å…©äººç¸½å­˜æ¬¾</span><span className="font-bold text-white">{formatMoney(stats.yaoSaved + stats.shuanSaved)}</span></div>
                                    <div className="hidden sm:block w-px bg-white/20"></div>
                                    <div><span className="block opacity-70">å…¬åŸºé‡‘å·²æ”¯å‡º</span><span className="font-bold text-white">{formatMoney(stats.totalExpensePaid - (stats.yaoPaidDirectly + stats.shuanPaidDirectly))}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Breakdown */}
                    <div className="bg-white border border-slate-100 rounded-2xl p-5 shadow-sm">
                        <h3 className="font-bold text-slate-700 flex items-center gap-2 mb-4">{PieChart && <PieChart size={18} className="text-slate-400"/>} ç›®å‰è³‡é‡‘çµæ§‹ (å·²å¯¦éš›å…¥å¸³)</h3>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <div className="flex justify-between items-center mb-3 pb-2 border-b border-slate-200"><span className="font-bold text-slate-700">å ¯</span><span className="font-bold text-sky-600">{formatMoney(breakdown.yao.total)}</span></div>
                                <div className="space-y-2 text-sm text-slate-600">
                                    <div className="flex justify-between"><span>æœˆå­˜ç´¯ç©</span><span className="font-mono">{formatMoney(breakdown.yao.monthly)}</span></div>
                                    <div className="flex justify-between"><span>å­£åº¦åˆ†ç´…</span><span className="font-mono">{formatMoney(breakdown.yao.bonus)}</span></div>
                                    <div className="flex justify-between"><span>å¹´çµ‚çé‡‘</span><span className="font-mono">{formatMoney(breakdown.yao.yearEnd)}</span></div>
                                    <div className="flex justify-between text-xs text-slate-400"><span>åˆæœŸè³‡é‡‘/æ ¡æ­£</span><span className="font-mono">{formatMoney(breakdown.yao.adjustment)}</span></div>
                                </div>
                            </div>
                            <div className="bg-slate-50 p-4 rounded-xl border border-slate-100">
                                <div className="flex justify-between items-center mb-3 pb-2 border-b border-slate-200"><span className="font-bold text-slate-700">ç’‡</span><span className="font-bold text-rose-500">{formatMoney(breakdown.shuan.total)}</span></div>
                                <div className="space-y-2 text-sm text-slate-600">
                                    <div className="flex justify-between"><span>æœˆå­˜ç´¯ç©</span><span className="font-mono">{formatMoney(breakdown.shuan.monthly)}</span></div>
                                    <div className="flex justify-between"><span>å­£åº¦åˆ†ç´…</span><span className="font-mono">{formatMoney(breakdown.shuan.bonus)}</span></div>
                                    <div className="flex justify-between"><span>å¹´çµ‚çé‡‘</span><span className="font-mono">{formatMoney(breakdown.shuan.yearEnd)}</span></div>
                                    <div className="flex justify-between text-xs text-slate-400"><span>åˆæœŸè³‡é‡‘/æ ¡æ­£</span><span className="font-mono">{formatMoney(breakdown.shuan.adjustment)}</span></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Next Expense Card */}
                    {nextExpense ? (
                        <div className="bg-white rounded-2xl shadow-md border-t-4 border-slate-600 overflow-hidden">
                            <div className="p-6">
                                <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-6">
                                    <div>
                                        <h2 className="text-slate-500 text-sm font-bold uppercase tracking-wider mb-1 flex items-center gap-2">{AlertCircle && <AlertCircle size={16} className="text-slate-600" />} ä¸‹ä¸€æœŸæ‡‰ç¹³å·¥ç¨‹æ¬¾</h2>
                                        <div className="flex flex-wrap items-baseline gap-2"><span className="text-3xl font-bold text-slate-800">{nextExpense.label}</span><span className="text-sm text-slate-400 font-mono">é è¨ˆæ—¥æœŸ: {nextExpense.date}</span></div>
                                    </div>
                                    <div className={`px-4 py-3 rounded-xl border flex flex-col items-end min-w-[180px] ${balanceStatus.status === 'sufficient' ? 'bg-teal-50 border-teal-200 text-teal-700' : 'bg-red-50 border-red-200 text-red-700'}`}>
                                        <span className="text-xs font-bold uppercase mb-1">è³‡é‡‘é ä¼°</span>
                                        <div className="flex items-center gap-1"><span className="text-lg font-bold">{balanceStatus.diff >= 0 ? '+' : ''}{formatMoney(balanceStatus.diff)}</span></div>
                                        <span className="text-xs opacity-80">{balanceStatus.status === 'sufficient' ? 'è¶³å¤ æ”¯ä»˜' : 'è³‡é‡‘ä¸è¶³'}</span>
                                    </div>
                                </div>
                                <div className="bg-slate-50 rounded-xl p-4 border border-slate-100">
                                    <div className="mb-4 flex items-center gap-3">
                                        <div className="bg-white p-2 rounded-full shadow-sm border border-slate-100">{DollarSign && <DollarSign className="text-slate-400" />}</div>
                                        <div><span className="block text-sm text-slate-500">æœ¬æœŸæ‡‰ç¹³ç¸½é‡‘é¡</span><span className="block text-xl font-bold text-slate-800">{formatMoney(nextExpense.cost)}</span></div>
                                    </div>
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 mb-1">å ¯ è‡ªä»˜/ä»£å¢Š (è‹¥ä¸å¾å…¬åŸºé‡‘æ‰£)</label>
                                            <input type="number" placeholder="è¼¸å…¥é‡‘é¡" value={expenseInput.yao} onChange={(e) => setExpenseInput(prev => ({...prev, yao: e.target.value}))} className="w-full p-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 outline-none bg-white"/>
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold text-slate-500 mb-1">ç’‡ è‡ªä»˜/ä»£å¢Š (è‹¥ä¸å¾å…¬åŸºé‡‘æ‰£)</label>
                                            <input type="number" placeholder="è¼¸å…¥é‡‘é¡" value={expenseInput.shuan} onChange={(e) => setExpenseInput(prev => ({...prev, shuan: e.target.value}))} className="w-full p-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-teal-500 outline-none bg-white"/>
                                        </div>
                                    </div>
                                    <div className="flex justify-end">
                                        <button onClick={() => confirmExpenseAction(nextExpense.id)} disabled={balanceStatus.status === 'insufficient' && (parseInt(expenseInput.yao||0) + parseInt(expenseInput.shuan||0)) === 0} className={`px-6 py-3 rounded-full font-bold flex items-center gap-2 transition-all shadow-sm w-full sm:w-auto justify-center ${balanceStatus.status === 'sufficient' || (parseInt(expenseInput.yao||0) + parseInt(expenseInput.shuan||0)) > 0 ? 'bg-slate-800 hover:bg-slate-700 text-white' : 'bg-slate-300 text-slate-500 cursor-not-allowed'}`}>ç¢ºèªç¹³æ¬¾ {ArrowRight && <ArrowRight size={18} />}</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        <div className="bg-teal-50 rounded-2xl p-8 text-center text-teal-800 border border-teal-100 shadow-sm">{CheckCircle2 && <CheckCircle2 size={48} className="mx-auto mb-3" />}<h2 className="text-2xl font-bold">æ‰€æœ‰å·¥ç¨‹æ¬¾é …çš†å·²æ”¯ä»˜å®Œç•¢ï¼</h2></div>
                    )}

                    {/* List */}
                    <div className="bg-white rounded-3xl shadow-lg shadow-stone-200/50 border border-stone-100 overflow-hidden">
                        <div className="p-4 border-b border-stone-100 bg-stone-50/50">
                            <h3 className="font-bold text-stone-700 flex items-center gap-2">{History && <History size={18} />} è³‡é‡‘æµå‹•æ­·ç¨‹</h3>
                        </div>
                        <div className="divide-y divide-stone-100">
                            {transactions.map((item) => {
                                if (item.subType === 'adjustment') {
                                    return (
                                        <div key={item.id} className="p-4 bg-stone-50 border-l-4 border-stone-300">
                                            <div className="flex items-center gap-4">
                                                <div className="p-2 bg-white rounded-xl text-stone-400 border border-stone-100">{Wallet && <Wallet size={20} />}</div>
                                                <div className="flex-1 min-w-0">
                                                    <p className="font-bold text-stone-800 truncate">{item.label}</p>
                                                    <p className="text-xs text-stone-500 whitespace-nowrap">æ—¥æœŸ: {item.date}</p>
                                                </div>
                                                <div className="text-right text-xs font-mono text-stone-500 shrink-0">
                                                    <div className="mb-1">å ¯è£œæ­£: {formatMoney(item.yaoAmount)}</div>
                                                    <div>ç’‡è£œæ­£: {formatMoney(item.shuanAmount)}</div>
                                                </div>
                                            </div>
                                        </div>
                                    )
                                }
                                if (item.type === 'expense') {
                                    return (
                                        <div key={item.id} className={`p-4 ${item.paidDate ? 'bg-amber-50/30' : 'bg-white'}`}>
                                            <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                                <div className="flex items-center gap-4 flex-1 min-w-0">
                                                    <div className={`p-2 rounded-xl shrink-0 border ${item.paidDate ? 'bg-amber-100 text-amber-700 border-amber-200' : 'bg-stone-50 text-stone-400 border-stone-100'}`}>{AlertCircle && <AlertCircle size={24} />}</div>
                                                    <div className="flex-1 min-w-0">
                                                        <p className="font-bold text-stone-800 truncate">{item.label}</p>
                                                        <p className="text-xs text-stone-500 whitespace-nowrap">æ—¥æœŸ: {item.date}</p>
                                                        <p className="text-sm font-bold text-rose-500 mt-1">è²»ç”¨: {formatMoney(item.cost)}</p>
                                                    </div>
                                                </div>
                                                {item.paidDate ? (
                                                    <div className="flex flex-col items-end min-w-[120px] shrink-0">
                                                        <span className="flex items-center gap-1 text-green-600 font-bold text-sm">{CheckCircle2 && <CheckCircle2 size={16} />} å·²æ”¯ä»˜</span>
                                                        {item.paidDetails && (item.paidDetails.yao > 0 || item.paidDetails.shuan > 0) ? (
                                                            <div className="text-xs text-stone-500 mt-1 text-right">{item.paidDetails.yao > 0 && <div>å ¯è‡ªä»˜: {formatMoney(item.paidDetails.yao)}</div>}{item.paidDetails.shuan > 0 && <div>ç’‡è‡ªä»˜: {formatMoney(item.paidDetails.shuan)}</div>}</div>
                                                        ) : (<div className="text-[10px] text-stone-400 mt-1">ç”±å…¬åŸºé‡‘æ”¯ä»˜</div>)}
                                                    </div>
                                                ) : (<div className="px-3 py-1 bg-stone-100 text-stone-500 text-xs rounded-full self-start sm:self-center shrink-0 font-bold">å¾…æ”¯ä»˜</div>)}
                                            </div>
                                        </div>
                                    );
                                }
                                const isFullySaved = item.yaoPaidDate && item.shuanPaidDate;
                                const isEditingYao = editingTransaction?.id === item.id && editingTransaction?.person === 'yao';
                                const isEditingShuan = editingTransaction?.id === item.id && editingTransaction?.person === 'shuan';

                                return (
                                    <div key={item.id} className={`p-4 hover:bg-stone-50 transition-colors ${isFullySaved ? 'bg-teal-50/20' : ''}`}>
                                        <div className="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                                            <div className="flex items-center gap-4 flex-1 min-w-0">
                                                <div className={`p-2 rounded-xl shrink-0 border ${item.subType === 'bonus' ? 'bg-purple-50 text-purple-500 border-purple-100' : 'bg-sky-50 text-sky-500 border-sky-100'}`}>
                                                    {item.subType === 'bonus' && Wallet ? <Wallet size={20} /> : (Calendar && <Calendar size={20} />)}
                                                </div>
                                                <div className="flex-1 min-w-0">
                                                    <p className="font-bold text-stone-700 truncate">{item.label}</p>
                                                    <p className="text-xs text-stone-400 whitespace-nowrap">åˆè¨ˆå­˜å…¥: {formatMoney(item.yaoAmount + item.shuanAmount)}</p>
                                                </div>
                                            </div>
                                            <div className="flex gap-2 sm:gap-4 flex-1 justify-end items-center">
                                                {isEditingYao ? (
                                                    <div className="flex items-center gap-1 bg-white p-1 rounded-full border border-sky-200 shadow-sm animate-in fade-in zoom-in duration-200">
                                                        <input type="number" value={editValue} onChange={(e) => setEditValue(e.target.value)} className="w-20 text-sm p-1 border-none bg-transparent focus:outline-none text-center" autoFocus />
                                                        <button onClick={() => confirmSaving(item.id, 'yao')} className="p-1 bg-green-500 text-white rounded-full hover:bg-green-600">{Check && <Check size={16} />}</button>
                                                        <button onClick={cancelEditing} className="p-1 bg-stone-200 text-stone-500 rounded-full hover:bg-stone-300">{X && <X size={16} />}</button>
                                                    </div>
                                                ) : (
                                                    <button onClick={() => item.yaoPaidDate ? undoSaving(item.id, 'yao') : startEditing(item, 'yao')} className={`flex items-center gap-2 px-4 py-3 rounded-full border transition-all min-w-[140px] sm:min-w-[160px] justify-between ${item.yaoPaidDate ? 'bg-green-100 border-green-200 text-green-800' : 'bg-white border-stone-200 text-stone-400 hover:border-sky-300 hover:bg-sky-50'}`}>
                                                        <span className="text-sm font-bold text-stone-600">å ¯</span>
                                                        <div className="text-right"><span className="block text-xs font-bold font-mono">{formatMoney(item.yaoAmount)}</span><span className="block text-[10px] opacity-70">{item.yaoPaidDate ? 'å·²å…¥å¸³' : 'ç¢ºèªå­˜æ¬¾'}</span></div>
                                                    </button>
                                                )}
                                                
                                                {isEditingShuan ? (
                                                    <div className="flex items-center gap-1 bg-white p-1 rounded-full border border-rose-200 shadow-sm animate-in fade-in zoom-in duration-200">
                                                        <input type="number" value={editValue} onChange={(e) => setEditValue(e.target.value)} className="w-20 text-sm p-1 border-none bg-transparent focus:outline-none text-center" autoFocus />
                                                        <button onClick={() => confirmSaving(item.id, 'shuan')} className="p-1 bg-green-500 text-white rounded-full hover:bg-green-600">{Check && <Check size={16} />}</button>
                                                        <button onClick={cancelEditing} className="p-1 bg-stone-200 text-stone-500 rounded-full hover:bg-stone-300">{X && <X size={16} />}</button>
                                                    </div>
                                                ) : (
                                                    <button onClick={() => item.shuanPaidDate ? undoSaving(item.id, 'shuan') : startEditing(item, 'shuan')} className={`flex items-center gap-2 px-4 py-3 rounded-full border transition-all min-w-[140px] sm:min-w-[160px] justify-between ${item.shuanPaidDate ? 'bg-green-100 border-green-200 text-green-800' : 'bg-white border-stone-200 text-stone-400 hover:border-rose-300 hover:bg-rose-50'}`}>
                                                        <span className="text-sm font-bold text-stone-600">ç’‡</span>
                                                        <div className="text-right"><span className="block text-xs font-bold font-mono">{item.shuanAmount}</span><span className="block text-[10px] opacity-70">{item.shuanPaidDate ? 'å·²å…¥å¸³' : 'ç¢ºèªå­˜æ¬¾'}</span></div>
                                                    </button>
                                                )}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            )
        };
        
        const RootComponent = () => {
            const [isAuthenticated, setIsAuthenticated] = useState(false);
            
            return isAuthenticated ? (
                <App />
            ) : (
                <LoginScreen onLogin={() => setIsAuthenticated(true)} />
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<RootComponent />);
    </script>
</body>
</html>
